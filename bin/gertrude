#!/usr/bin/env ruby

require "optparse"

options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: example.rb [options]"

  opts.on("-f", "--file [FILEPATH]", String, "Pass the yml file (Default is 0.0.0.0)") do |file|
    options[:file] = file
  end

  opts.on("-p", "--port [PORT]", Integer, "Assign server port (Default is 4567)") do |p|
    options[:port] = p
  end

  opts.on("-e", "--environment [ENV]", String, "Set Sinatra environment (Default is development)") do |env|
    options[:environment] = env
  end

  opts.on("-o", "--host [HOST]", String, "Set the host address (Default is 0.0.0.0)") do |host|
    options[:host] = host
  end

  opts.on("-h", "--help", "Display this help") do
    puts opts
    exit
  end
end.parse!

require "gertrude"

command = ARGV[0].downcase

#TODO Fix me. These things need to happen
if command.eql? 'start'
  #TODO raise error is there isn't a file provided
  ItemServer.run!(options)
elsif command.eql? 'restart'
  #TODO raise error is there isn't a file provided
  #TODO kill the running server.
  ItemServer.run!(options)
elsif command.eql? 'stop'
  #TODO raise warn if a server isn't running
  #TODO kill the running server.
else
  raise "Command #{ARGV[0]} is not valid. Please use 'start', 'stop', or 'restart'."
end

